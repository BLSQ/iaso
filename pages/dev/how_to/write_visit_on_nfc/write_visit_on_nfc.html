
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      
      <link rel="icon" href="../../../../assets/iaso-favicon.png">
      <meta name="generator" content="mkdocs-1.5.2, mkdocs-material-9.1.1">
    
    
      
        <title>Forewords - IASO</title>
      
    
    
      <link rel="stylesheet" href="../../../../assets/stylesheets/main.402914a4.min.css">
      
        
        <link rel="stylesheet" href="../../../../assets/stylesheets/palette.a0c5b2b5.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../../../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="custom" data-md-color-accent="">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#forewords" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../../../index.html" title="IASO" class="md-header__button md-logo" aria-label="IASO" data-md-component="logo">
      
  <img src="../../../../assets/iaso.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            IASO
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Forewords
            
          </span>
        </div>
      </div>
    </div>
    
    
      <div class="md-header__option">
        <div class="md-select">
          
          <button class="md-header__button md-icon" aria-label="Select language">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m12.87 15.07-2.54-2.51.03-.03A17.52 17.52 0 0 0 14.07 6H17V4h-7V2H8v2H1v2h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04M18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12m-2.62 7 1.62-4.33L19.12 17h-3.24Z"/></svg>
          </button>
          <div class="md-select__inner">
            <ul class="md-select__list">
              
                <li class="md-select__item">
                  <a href="write_visit_on_nfc.html" hreflang="en" class="md-select__link">
                    English
                  </a>
                </li>
              
                <li class="md-select__item">
                  <a href="../../../../fr/pages/dev/how_to/write_visit_on_nfc/write_visit_on_nfc.html" hreflang="fr" class="md-select__link">
                    Fran√ßais
                  </a>
                </li>
              
                <li class="md-select__item">
                  <a href="../../../../es/pages/dev/how_to/write_visit_on_nfc/write_visit_on_nfc.html" hreflang="es" class="md-select__link">
                    Espa√±ol
                  </a>
                </li>
              
            </ul>
          </div>
        </div>
      </div>
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/BLSQ/iaso" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.3.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
<!-- Navigation -->


<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
    <div class="md-sidebar__scrollwrap">
        <div class="md-sidebar__inner">
            


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../../index.html" title="IASO" class="md-nav__button md-logo" aria-label="IASO" data-md-component="logo">
      
  <img src="../../../../assets/iaso.png" alt="logo">

    </a>
    IASO
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/BLSQ/iaso" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.3.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../../index.html" class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
      
      
      
        <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
          Users
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Users
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../users/reference/iaso_concepts/iaso_concepts.html" class="md-nav__link">
        Concepts
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../users/reference/iaso_modules/iaso_modules.html" class="md-nav__link">
        Modules
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../users/reference/iaso_web/user_guide.html" class="md-nav__link">
        Web Platform
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../users/reference/iaso_mobile/iaso_mobile.html" class="md-nav__link">
        Mobile Application
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
      
      
      
        <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
          Developers
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Developers
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1" >
      
      
      
        <label class="md-nav__link" for="__nav_3_1" id="__nav_3_1_label" tabindex="0">
          References
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_1_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3_1">
          <span class="md-nav__icon md-icon"></span>
          References
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/data_model_glossary/data_model_glossary.html" class="md-nav__link">
        Data model glossary
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/sql_dashboard/SQL_Dashboard_feature.html" class="md-nav__link">
        SQL Dashboard feature
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/docker/docker.html" class="md-nav__link">
        Docker
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/background_tasks/background_tasks.html" class="md-nav__link">
        Background tasks & worker
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/env_variables/env_variables.html" class="md-nav__link">
        Environnement variables
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1_6" >
      
      
      
        <label class="md-nav__link" for="__nav_3_1_6" id="__nav_3_1_6_label" tabindex="0">
          Models
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_1_6_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3_1_6">
          <span class="md-nav__icon md-icon"></span>
          Models
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/API/entity.html" class="md-nav__link">
        API reference: Entity
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2" >
      
      
      
        <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
          How to
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3_2">
          <span class="md-nav__icon md-icon"></span>
          How to
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../contribute/contribute.html" class="md-nav__link">
        Contribute
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../setup_dev_env/setup_dev_env.html" class="md-nav__link">
        Setup a dev environment
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../use_iaso_apis/use_iaso_apis.html" class="md-nav__link">
        Use iaso apis
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
      
      
      
        <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
          More about IASO
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          More about IASO
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="https://www.openiaso.com/" class="md-nav__link">
        IASO website
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="https://www.digitalpublicgoods.net/r/iaso" class="md-nav__link">
        Digital Public Goods Registry
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="https://github.com/BLSQ/iaso/releases" class="md-nav__link">
        Release notes
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="https://www.bluesquarehub.com/" class="md-nav__link">
        Bluesquare website
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
            <!-- pdf download  -->
            <div id="pdf-download-container">
                <button id="pdf-download" type="button">
                    <span id="button-text">Download current page</span>
                    <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px"
                        fill="#192041">
                        <path
                            d="M360-460h40v-80h40q17 0 28.5-11.5T480-580v-40q0-17-11.5-28.5T440-660h-80v200Zm40-120v-40h40v40h-40Zm120 120h80q17 0 28.5-11.5T640-500v-120q0-17-11.5-28.5T600-660h-80v200Zm40-40v-120h40v120h-40Zm120 40h40v-80h40v-40h-40v-40h40v-40h-80v200ZM320-240q-33 0-56.5-23.5T240-320v-480q0-33 23.5-56.5T320-880h480q33 0 56.5 23.5T880-800v480q0 33-23.5 56.5T800-240H320Zm0-80h480v-480H320v480ZM160-80q-33 0-56.5-23.5T80-160v-560h80v560h560v80H160Zm160-720v480-480Z" />
                    </svg>
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Table of contents -->


<div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
    <div class="md-sidebar__scrollwrap">
        <div class="md-sidebar__inner">
            

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
</nav>
        </div>
    </div>
</div>



          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
    <a href="https://github.com/BLSQ/iaso/edit/main/docs/pages/dev/how_to/write_visit_on_nfc/write_visit_on_nfc.en.md" title="Edit this page" class="md-content__button md-icon">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4v-2m10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1 2.1 2.1Z"/></svg>
    </a>
  
  


<h1 id="forewords">Forewords<a class="headerlink" href="#forewords" title="Permanent link">#</a></h1>
<p>In the context of CODA2, Iaso will have to write some forms‚Äô information
on an NFC card. The NFC card‚Äôs size may vary in the future, but the
current size of the card is 8k. Yet, the card is currently split into
two partitions; one is used by CODA and the other by SCOPE. SCOPE has
6kB out of the 8, leaving 2kB to CODA.</p>
<p>Famoco provided the implementation for the CODA 1.5 application.</p>
<p>We know that the patient‚Äôs profile can take up to 500B, and the
subsequent visits can take up to 144B with a total of 8 visits maximum.</p>
<p>This gives us a total of 1652B if all slots are filled.</p>
<p>I assume that the remaining 396B (2048 - 1652) is the encryption
overhead.</p>
<blockquote>
<p><em>Assuming Famoco is using an AES/CBC symmetric encryption with a salt
of 256B and an IV (initialization vector) of 16B over the whole data,
the assumption would hold.</em></p>
</blockquote>
<h1 id="famocos-split">Famoco‚Äôs split<a class="headerlink" href="#famocos-split" title="Permanent link">#</a></h1>
<p>In the documentation provided by Famoco, called <em>DESFireService_v1.0.1</em>,
they mention two types of writing:</p>
<ol>
<li>
<p>File ‚Äú01‚Äù, which we‚Äôll call the profile, is up to 500B</p>
</li>
<li>
<p>File ‚Äú02‚Äù, which we‚Äôll call the visits, is of variable length based
    &gt; on the type of card used.</p>
</li>
</ol>
<p>The profile is marked as a binary file overridden on each writing.</p>
<p>The visits are marked as a cyclic record. Every time a visit is
recorded, it is added to the previous ones. If the max length is
reached, the oldest record is deleted to make room for the new one
(FIFO).</p>
<table>
<thead>
<tr>
<th>‚ùì It is yet to be defined if a model outside of Famoco should follow the same split and enforce the writing of one record at a time.</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
</tr>
</tbody>
</table>
<h1 id="ndef-messages-and-ndef-records">NDEF Messages and NDEF Records<a class="headerlink" href="#ndef-messages-and-ndef-records" title="Permanent link">#</a></h1>
<p><a href="https://developer.android.com/reference/android/nfc/tech/Ndef"><u><strong>N</strong>FC</u> <u><strong>D</strong>ata</u> <u><strong>E</strong>xchange</u>
<u><strong>F</strong>ormat</u></a>
(or NDEF) is a lightweight binary format, used to encapsulate typed
data. It is specified by the NFC Forum, for transmission and storage
with NFC. However, it is transport agnostic.</p>
<p>The format defines Messages and Records:</p>
<ul>
<li>
<p>An NDEF Record contains typed data, such as MIME-type media, a URI,
    &gt; or a custom application payload.</p>
</li>
<li>
<p>An NDEF Message is a container for one or more NDEF Records.</p>
</li>
</ul>
<h1 id="why-use-ndef">Why use NDEF?<a class="headerlink" href="#why-use-ndef" title="Permanent link">#</a></h1>
<p>As described in the <a href="https://developer.android.com/reference/android/nfc/tech/Ndef"><u>Android
documentation</u></a>,
It is mandatory for all Android devices with NFC to correctly enumerate
Ndef on NFC Forum Tag Types 1-4, and implement all NDEF operations as
defined in said documentation.</p>
<p>Therefore, it guarantees that a perfectly written tag will be readable
by all Android devices with NFC.</p>
<p>Finally, the overhead of NDEF is existent but can be considered
negligible compared to the advantages it brings. Based on this
<a href="https://stackoverflow.com/a/29606687/2637428"><u>StackOverflow
answer</u></a>, the overhead
is roughly 12 bytes:</p>
<ul>
<li>
<p>NDEF Header byte: 1 byte</p>
</li>
<li>
<p>NDEF type length field: 1 byte</p>
</li>
<li>
<p>NDEF payload length field: 1-4 bytes</p>
</li>
<li>
<p>NDEF type name "iaso:p" (external type): 6 bytes</p>
</li>
</ul>
<h1 id="encryption">Encryption<a class="headerlink" href="#encryption" title="Permanent link">#</a></h1>
<p>Famoco‚Äôs devices are relying on a <a href="https://en.wikipedia.org/wiki/Secure_access_module"><u><strong>S</strong>ecure</u> <u><strong>A</strong>ccess</u>
<u><strong>M</strong>odule</u></a>
(or SAM) chip which encrypts and guarantees a secured shared secret
across the authorized devices.</p>
<p>Unfortunately, regular Android devices can't rely on such a chip.
Therefore, we must find a solution to encrypt the card's data in a way
only decipherable by another authorized device without an internet
connection.</p>
<p>Since all the authorized devices will need to be able to encrypt and
decrypt the data, there is no need to go with asymmetric encryption.</p>
<p><strong>The current standard for symmetric encryption is AES.</strong></p>
<h2 id="the-overhead">The overhead<a class="headerlink" href="#the-overhead" title="Permanent link">#</a></h2>
<p>As explained in this <a href="https://stackoverflow.com/a/93463/2637428"><u>StackOverflow
answer</u></a>, AES doesn‚Äôt
expand data, but the padding will.</p>
<p>The maximum amount of padding is up to the padding algorithm.</p>
<p>In the case of
<a href="https://en.wikipedia.org/wiki/Padding_%28cryptography%29#PKCS#5_and_PKCS#7"><u>PKCS7Padding</u></a>,
it should be up to 16 bytes as defined in the
<a href="https://www.ietf.org/rfc/rfc3602.txt"><u>RFC3602</u></a>.</p>
<p>On top of that, it‚Äôs good practice to
<a href="https://en.wikipedia.org/wiki/Salt_(cryptography)"><u>salt</u></a> the
password to make the deciphering even more complex, avoid rainbow tables
attacks, and avoid being able to compare two identical records (which is
more likely to happen with small forms).</p>
<p>AES also comes with the concept of <a href="https://en.wikipedia.org/wiki/Initialization_vector"><u><strong>I</strong>nitialization</u>
<u><strong>V</strong>ector</u></a>
(or IV) randomly generated on each encryption.</p>
<p>The salt and the IV will be communicated in clear text alongside the
encrypted data to be able to decrypt it. Therefore, they will add up to
the number of bytes written on the card.</p>
<table>
<thead>
<tr>
<th>üîê As advised by the <a href="https://nvlpubs.nist.gov/nistpubs/Legacy/SP/nistspecialpublication800-132.pdf"><u><strong>N</strong>ational</u> <u><strong>I</strong>nstitute of</u> <u><strong>S</strong>tandards and</u> <u><strong>T</strong>echnology</u></a> (NIST), the length of the randomly-generated portion of the <strong>salt</strong> <strong>shall be at least <a href="https://nvlpubs.nist.gov/nistpubs/Legacy/SP/nistspecialpublication800-132.pdf"><u>128 bits</u></a></strong> (16 bytes)<strong>.</strong> In the current PoC implementation, it‚Äôs 256 bytes.</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>üîê AES requires an IV size of 16 bytes</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
</tr>
</tbody>
</table>
<p>The total overhead is therefore of the size of the salt (256B), the size
of the IV (16B), and the padding (up to 16B), which sums up to 288B but
could be lowered to 48B if we reduce the salt to 16B for lesser
security.</p>
<h2 id="how-the-data-is-split">How the data is split<a class="headerlink" href="#how-the-data-is-split" title="Permanent link">#</a></h2>
<p>The overhead discussed previously is computed per encryption; if we
encrypt all the data at once, the overhead is of that amount. If we
encrypt the profile and the visits separately, the overhead is
multiplied by two. The overhead is much higher if we encrypt the profile
and each visit individually.</p>
<table>
<thead>
<tr>
<th>üîê I don‚Äôt have sufficient knowledge to tell if there is any security benefit in one or the other approach. Yet, based on the size of the available space on the card, I assume we should encrypt all the data at once or encrypt the profile and the visits separately but not all the visits apiece.</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
</tr>
</tbody>
</table>
<h1 id="sharing-the-nfc-password-securely">Sharing the NFC password securely<a class="headerlink" href="#sharing-the-nfc-password-securely" title="Permanent link">#</a></h1>
<p>Every security measure is as strong as its weakest link. The whole
encryption mechanism is rendered useless if the password is too weak,
easily guessable, or easily accessible.</p>
<p>Therefore, we need to find a good way to share the password while
considering the complexity for the end user to obtain it.</p>
<table>
<thead>
<tr>
<th>üòà Keep in mind that nothing is 100% secure. All the solutions we could come up with have flaws, even the SAM chip used by Famoco. Yet, we can only make it harder and harder for someone to retrieve the key to the point that they either can‚Äôt retrieve it (missing skills or hardware) or don‚Äôt find that it is worth their while.</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
</tr>
</tbody>
</table>
<h2 id="embedded-inside-the-apk">Embedded inside the APK<a class="headerlink" href="#embedded-inside-the-apk" title="Permanent link">#</a></h2>
<p>The easiest way to share a password across authorized devices is to
embed it directly into the APK (an APK is a file containing the code and
resources of an application that an Android device can interpret to
install it).</p>
<p>Yet, this solution is only viable if, <strong>and only if</strong>, the APK is
distributed via a <strong>M</strong>obile <strong>D</strong>evice <strong>M</strong>anagement (or MDM) and that
the MDM can securely prevent people from retrieving the APK from the
device.</p>
<p>If the APK is distributed via the Play Store (or any other means that is
publicly available or that allow retrieving the APK), the password must
be considered compromised and rendered useless.</p>
<p><em>This solution is similar to what Famoco is doing since, in their case,
the password is embedded and secured inside the SAM chip.</em></p>
<h2 id="over-the-network">Over the network<a class="headerlink" href="#over-the-network" title="Permanent link">#</a></h2>
<p>This solution is easy for the end user, but more vulnerable as anyone
can make a network request.</p>
<p>The client should make an authorized (given a valid token previously
retrieved with valid credentials) request to a specific endpoint.</p>
<p>The endpoint would receive a public key (from an asymmetric encryption
scheme like RSA) of a hardware-backed key pair as described in
<a href="https://developer.android.com/training/articles/security-key-attestation"><u>Android‚Äôs
documentation</u></a>.</p>
<p>The backend would be able to verify the validity of the key and its
certificate chain, pointing to a Google valid certificate, and
containing the correct application ID and signature.</p>
<p>The password would then be encrypted by the backend with the public key
and communicated back to the phone. The application should then be able
to decrypt the password and store it securely.</p>
<p>This solution involves that only the application can decrypt the given
password.</p>
<table>
<thead>
<tr>
<th>üîë This is the investigated solution at the moment of this writing but we are unsure how secure this would be on a rooted Android device.</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
</tr>
</tbody>
</table>
<p>This solution involves security measures that can be hard for attackers
to obtain:</p>
<ol>
<li>
<p>Valid credentials</p>
</li>
<li>
<p>A compromised phone with the application on it.</p>
</li>
<li>
<p>A way to compromise the device in a way it is not detected by
    &gt; Android.</p>
</li>
</ol>
<h2 id="over-a-physical-device">Over a physical device<a class="headerlink" href="#over-a-physical-device" title="Permanent link">#</a></h2>
<p>If the password is stored inside a physical device (like a USB key, a
specific phone application, etc.) that is provided in limited quantities
to trusted members of the organization, it can be shared through
physical contact between the device to authorize and the trusted member
with the physical device.</p>
<p>The password is then securely stored on the authorized device for later
use.</p>
<p>This solution is secure but could be cumbersome. For example, if there
are many devices to authorize, it can take a long time to transfer the
password on each device. There could also be an issue if the devices are
spread across the country, and the trusted members must go to each
location to authorize the devices.</p>
<h2 id="a-mix-of-the-above-solutions">A mix of the above solutions<a class="headerlink" href="#a-mix-of-the-above-solutions" title="Permanent link">#</a></h2>
<p>The solutions provided above are not exhaustive and can also be mixed.
For example, we could consider storing the password on a physical device
to be encrypted with a key that needs to be retrieved via an authorized
network request.</p>
<p>The more barrier we put in recovering the key, the more secure it is.
Yet, it also makes the logistics for genuine authorized devices more
complex.</p>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../../../..", "features": ["content.action.edit"], "search": "../../../../assets/javascripts/workers/search.208ed371.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../../assets/javascripts/bundle.b78d2936.min.js"></script>
      
        <script src="../../../../extrajs/html2pdf.bundle.min.js"></script>
      
        <script src="../../../../extrajs/pdfDownload.js"></script>
      
        <script src="https://plausible.io/js/script.js"></script>
      
    
  </body>
</html>