<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../../../../img/favicon.ico" />
    <title>Front-end reference - IASO</title>
    <link rel="stylesheet" href="../../../../css/theme.css" />
    <link rel="stylesheet" href="../../../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
        <link href="../../../../assets/_mkdocstrings.css" rel="stylesheet" />
        <link href="../../../../stylesheets/extra.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Front-end reference";
        var mkdocs_page_input_path = "pages/dev/reference/front-end_reference/front-end_reference.md";
        var mkdocs_page_url = null;
      </script>
    
    <script src="../../../../js/jquery-3.6.0.min.js" defer></script>
    <!--[if lt IE 9]>
      <script src="../../../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
      <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../../../../index.html">
          <img src="../../../../assets/iaso.png" class="logo" alt="Logo"/>
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../../../index.html">Home</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Users</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../users/reference/iaso_concepts/iaso_concepts.html">Concepts</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../users/reference/iaso_modules/iaso_modules.html">Modules</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../users/reference/iaso_web/user_guide.html">Web Platform</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../users/reference/iaso_mobile/iaso_mobile.html">Mobile Application</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Developers</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="#">References</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../data_model_glossary/data_model_glossary.html">Data model glossary</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../sql_dashboard/SQL_Dashboard_feature.html">SQL Dashboard feature</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../docker/docker.html">Docker</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../background_tasks/background_tasks.html">Background tasks & worker</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../env_variables/env_variables.html">Environnement variables</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="#">Models</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../API/entity.html">API reference: Entity</a>
                </li>
    </ul>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="#">How to</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../how_to/contribute/contribute.html">Contribute</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../how_to/setup_dev_env/setup_dev_env.html">Setup a dev environment</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../how_to/use_iaso_apis/use_iaso_apis.html">Use iaso apis</a>
                </li>
    </ul>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">More about Iaso</span></p>
              <ul>
                  <li class="toctree-l1"><a class="" href="https://www.openiaso.com/">Get a demo</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="https://www.bluesquarehub.com/">Bluesquare</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">IASO</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../../../index.html" class="icon icon-home" alt="Docs"></a> &raquo;</li>
      <li>Front-end reference</li>
    <li class="wy-breadcrumbs-aside">
          <a href="https://github.com/BLSQ/iaso/edit/main/docs/pages/dev/reference/front-end_reference/front-end_reference.md" class="icon icon-github"> Edit on GitHub</a>
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="front-end-reference">Front-end reference<a class="headerlink" href="#front-end-reference" title="Permanent link">#</a></h1>
<p>Frontend assets include JS, CSS, translations and images. They are all handled
by webpack. Most of the structure is taken from this blog post:
http://owaislone.org/blog/webpack-plus-reactjs-and-django/</p>
<p>Frontend assets are mounted on the pages via the
<code>django-webpack-loader &lt;https://github.com/owais/django-webpack-loader&gt;</code>__</p>
<h1 id="build">Build<a class="headerlink" href="#build" title="Permanent link">#</a></h1>
<h2 id="the-2-builds-dev-and-prod">The 2 builds, dev and prod<a class="headerlink" href="#the-2-builds-dev-and-prod" title="Permanent link">#</a></h2>
<ul>
<li>
<p>There are two webpack configuration files: <code>webpack.dev.js</code> and <code>webpack.prod.js</code>.</p>
</li>
<li>
<p>A JS production build is created inside the docker-file, via <code>npm run build</code></p>
</li>
<li>
<p>the <code>start_dev</code> entry point starts a webpack development server, that watches
  assets, rebuilds and does hot reloading of JS Components.</p>
</li>
</ul>
<h2 id="css-build">CSS Build<a class="headerlink" href="#css-build" title="Permanent link">#</a></h2>
<p>The CSS build is separate, and can contain both <code>.sass</code> and <code>.css</code> files.
They spit out a webpack build called <code>styles.css</code>.</p>
<h2 id="js-build">JS Build<a class="headerlink" href="#js-build" title="Permanent link">#</a></h2>
<p>Each page has their own JS entry point (needs to be defined in both webpack files).
On top of that, they load a common chunk, containing <code>react</code>, <code>react-intl</code> and other
stuff that the <code>webpack common chunk</code> plugin finds is shared between the apps.</p>
<p>Including a JS bundle via django-webpack-loader
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</p>
<p>If we have created a new JS app <code>MyCustomApp</code> in <code>hat/assets/js/apps/</code>.</p>
<p>The entrypoint should be <code>/dashboard/my-custom-app</code></p>
<p>Folders and files affected::</p>
<pre><code>+ hat/
  + assets/
    + js/
      + apps/
        + MyCustomApp
          . index.js
          . MyCustomApp.js
          . MyCustomAppContainer.js

  + dashboard/
    . urls.py
    . views.py

  + templates/
    + dashboard/
      . my_custom_app.html

  . webpack.dev.js
  . webpack.prod.js
</code></pre>
<p>These are the steps to visualize it within the dashboard:</p>
<ul>
<li>In <code>hat/webpack.dev.js</code> include a new <code>entry</code>.</li>
</ul>
<pre><code class="language-javascript">    'my_custom_app': [
    'webpack-dev-server/client?' + WEBPACK_URL,
    'webpack/hot/only-dev-server',
    './assets/js/apps/MyCustomApp/index'
    ],
</code></pre>
<ul>
<li>In <code>hat/webpack.prod.js</code> include a new <code>entry</code>.</li>
</ul>
<pre><code class="language-javascript">    'my_custom_app': './assets/js/apps/MyCustomApp/index',
</code></pre>
<ul>
<li>In <code>hat/dashboard/views.py</code> include a new view.</li>
</ul>
<pre><code class="language-python">    @login_required()  # needs login?
    @permission_required('cases.view')  # the needed permissions
    @require_http_methods(['GET'])  # http methods allowed
    def my_custom_app(request: HttpRequest) -&gt; HttpResponse:
        return render(request, 'dashboard/my_custom_app.html')
</code></pre>
<ul>
<li>In <code>hat/dashboard/urls.py</code> include a new url pattern.</li>
</ul>
<pre><code class="language-python">    url(r'^my-custom-app/.*$', views.my_custom_app, name='my_custom_app'),
</code></pre>
<pre><code>  url(r'^my-custom-app/.*$', views.my_custom_app, name='my_custom_app'),
</code></pre>
<ul>
<li>In <code>hat/templates/dashboard</code> create a new template file <code>my_custom_app.html</code>.</li>
</ul>
<pre><code class="language-html">      {% extends 'app.html' %}
      {% load i18n %}
      {% load render_bundle from webpack_loader %}

      {% block header %}
        &lt;h1 class=&quot;header__title&quot;&gt;{% trans 'My Custom App' %}&lt;/h1&gt;
      {% endblock %}

      {% block content %}

        &lt;div class=&quot;content&quot;&gt;
          &lt;div id=&quot;app-container&quot;&gt;&lt;/div&gt;
        &lt;/div&gt;

        {% render_bundle 'common' %}
        {% render_bundle 'my_custom_app' %}
        &lt;script&gt;
          HAT.MyCustomApp.default(
            document.getElementById('app-container'),
            '/dashboard/my-custom-app/'
          )
        &lt;/script&gt;
      {% endblock %}
</code></pre>
<h1 id="testing-the-production-build">Testing the production build<a class="headerlink" href="#testing-the-production-build" title="Permanent link">#</a></h1>
<h1 id="stop-any-containers-that-might-be-currently-running">. Stop any containers that might be currently running.<a class="headerlink" href="#stop-any-containers-that-might-be-currently-running" title="Permanent link">#</a></h1>
<h1 id="start-the-containers-with">. Start the containers with:<a class="headerlink" href="#start-the-containers-with" title="Permanent link">#</a></h1>
<p>.. code:: shell</p>
<pre><code>  TEST_PROD=true docker compose up
</code></pre>
<p>When the setup is run with <code>TEST_PROD=true</code>, it will exit the unneeded containers
<code>webpack</code> and <code>jupyter</code>. It will also run the webpack build during startup, so
that there is no need to rebuild the image for that.</p>
<h2 id="js-unit-testing">JS Unit Testing<a class="headerlink" href="#js-unit-testing" title="Permanent link">#</a></h2>
<pre><code class="language-shell">    docker compose run hat test_js
</code></pre>
<h1 id="adding-new-assets-in-packagejson">Adding new assets in package.json<a class="headerlink" href="#adding-new-assets-in-packagejson" title="Permanent link">#</a></h1>
<p>Unfortunately, for now you need to rebuild the container after adding or
upgrading packages in <code>package.json</code>.</p>
<p>.. code:: shell</p>
<pre><code>docker compose build
</code></pre>
<p>or</p>
<p>.. code:: shell</p>
<pre><code>docker compose up --build
</code></pre>
<h1 id="translations">Translations<a class="headerlink" href="#translations" title="Permanent link">#</a></h1>
<p>Translations are extracted on the first webpack build. Just like the django
translation strings; translations are downloaded for every <code>Travis CI &lt;https://travis-ci.com&gt;</code>__
build, and uploaded on the <code>development</code> branch.</p>
<h1 id="set-up-vscode-for-front-end-development">Set up VSCode for front-end development<a class="headerlink" href="#set-up-vscode-for-front-end-development" title="Permanent link">#</a></h1>
<p>See also: <code>this pull request &lt;https://github.com/BLSQ/iaso/pull/120&gt;</code>__</p>
<p>The script <code>show-lint-problems</code> can be turned into a VSCode task that will show all linter errors in VSCode's PROBLEMS Tab.</p>
<p>Steps to follow:</p>
<ul>
<li>
<p>Go to Terminal&gt;Configure task</p>
</li>
<li>
<p>Select npm: show-lint-problems</p>
</li>
<li>
<p>Add <code>$eslint-stylish</code> to the <code>problemMatcher</code> array</p>
</li>
<li>
<p>Run the task: Terminal&gt;Run Task...&gt; npm: show-lint-problems. 
  IMPORTANT: you need to run the task this way. Running the script directly from the terminal using npm will not enable VS Code to display the problems in the PROBLEMS tab</p>
</li>
<li>
<p>You should be able to see and track the problems through the dedicated tab. 
  CAUTION: if you navigate to a file through the tab, then close the file, it will be removed from the problems list, even if it wasn't changed. This seems to be a problem with using npm through VSCode's tasks</p>
</li>
</ul>
<h1 id="depend-on-bluesquare-components-library">Depend on bluesquare-components library<a class="headerlink" href="#depend-on-bluesquare-components-library" title="Permanent link">#</a></h1>
<p>See the <code>library's README &lt;https://github.com/BLSQ/bluesquare-components/blob/main/README.md&gt;</code>__ for the general setup.</p>
<p>When depending on a local version of the library:</p>
<ul>
<li>
<p>Your local folder should be on the same level as the iaso folder, so that the path to the tgz file in your package.json is : ../bluesquare-components/bluesquare-components-0.1.0.tgz</p>
</li>
<li>
<p>Run <code>docker compose build --build-arg LIBRARY=&lt;name-of-the-library-image&gt;</code></p>
</li>
</ul>
              
            </div>
          </div><footer>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/BLSQ/iaso" class="fa fa-github" style="color: #fcfcfc"> GitHub</a>
        </span>
    
    
    
  </span>
</div>
    <script>var base_url = '../../../..';</script>
    <script src="../../../../js/theme_extra.js" defer></script>
    <script src="../../../../js/theme.js" defer></script>
      <script src="../../../../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
