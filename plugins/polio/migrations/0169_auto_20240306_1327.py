# Generated by Django 3.2.22 on 2024-03-06 13:27

from django.db import migrations, models


def add_default_campaign_types(apps, schema_editor):
    CType = apps.get_model("polio", "CampaignType")

    from plugins.polio.models import CampaignType as CTypeOrig

    CType.objects.get_or_create(name=CTypeOrig.POLIO)
    CType.objects.get_or_create(name=CTypeOrig.MEASLES)
    CType.objects.get_or_create(name=CTypeOrig.PIRI)
    CType.objects.get_or_create(name=CTypeOrig.YELLOW_FEVER)
    CType.objects.get_or_create(name=CTypeOrig.VITAMIN_A)
    CType.objects.get_or_create(name=CTypeOrig.RUBELLA)
    CType.objects.get_or_create(name=CTypeOrig.DEWORMING)


def set_default_campaign_type_to_existing_campaigns(apps, schema_editor):
    Campaign = apps.get_model("polio", "Campaign")
    CType = apps.get_model("polio", "CampaignType")
    from plugins.polio.models import CampaignType as CTypeOrig

    polio_type, _ = CType.objects.get_or_create(name=CTypeOrig.POLIO)

    for campaign in Campaign.objects.filter(campaign_types__isnull=True):
        campaign.campaign_types.add(polio_type)


class Migration(migrations.Migration):
    dependencies = [
        ("polio", "0168_auto_20240306_1327"),
    ]

    operations = [migrations.RunPython(add_default_campaign_types, set_default_campaign_type_to_existing_campaigns)]
