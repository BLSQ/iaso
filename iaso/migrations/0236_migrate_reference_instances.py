# Generated by Django 3.2.21 on 2023-09-19 09:39
"""
We are replacing `OrgUnit.reference_instance` by `OrgUnit.reference_instances`.
Before deleting `OrgUnit.reference_instance`, we need to move its data to the
new field.
"""


from django.db import migrations


def migrate_data_forward(apps, schema_editor):
    OrgUnit = apps.get_model("iaso", "OrgUnit")
    for org_unit in OrgUnit.objects.filter(reference_instance__isnull=False):
        if org_unit.reference_instance_id:
            org_unit.reference_instances.add(org_unit.reference_instance)
            org_unit.save()


class Migration(migrations.Migration):
    dependencies = [
        ("iaso", "0235_orgunit_reference_instances"),
    ]

    operations = [migrations.RunPython(migrate_data_forward, migrations.RunPython.noop, elidable=True)]
